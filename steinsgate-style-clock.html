<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>다이버전스 시계 - 오토 타임 리프</title>
    <style>
        /* (디자인 CSS는 이전과 동일하게 완벽한 상태를 유지합니다) */
        body {
            background-color: #050505; color: white;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            height: 100vh; margin: 0;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
        }

        .nixie-container { 
            display: flex; gap: 8px; margin-bottom: 50px; 
            cursor: pointer; transition: transform 0.1s;
        }
        .nixie-container:active { transform: scale(0.98); }
        .nixie-digit {
            font-size: 70px; color: #ffaa33;
            text-shadow: 0 0 10px #ff4400, 0 0 20px #ff2200, 0 0 40px #ff1100;
            background: rgba(30, 10, 0, 0.6);
            padding: 10px 15px; border-radius: 30px 30px 10px 10px;
            border: 2px solid #333; box-shadow: inset 0 0 15px rgba(0,0,0,0.8);
            width: 50px; text-align: center;
        }

        .flip-wrapper {
            display: flex; align-items: center; gap: 10px;
            background: linear-gradient(to bottom, #222, #000);
            padding: 20px 40px; border-radius: 10px;
            border-top: 2px solid #444; border-bottom: 2px solid #111;
            box-shadow: 0 10px 30px rgba(0,0,0,0.9);
        }
        .text-label {
            font-size: 30px; color: #00ff00; font-weight: bold; margin: 0 5px; text-shadow: 0 0 5px #00ff00;
        }
        .colon { font-size: 50px; color: #666; animation: blink 1s infinite; padding-bottom: 10px; }
        @keyframes blink { 50% { opacity: 0; } }

        .flip-digit {
            position: relative; width: 80px; height: 110px;
            font-size: 70px; font-weight: bold; color: #f0f0f0;
            perspective: 1000px; box-shadow: 0 4px 10px rgba(0,0,0,0.7);
            border-radius: 8px; background-color: #1a1a1a;
        }
        .flip-digit.weekday { width: 130px; color: #fff; }

        .flip-half {
            position: absolute; left: 0; width: 100%; height: 50%; 
            background-color: #1a1a1a; overflow: hidden; text-align: center; backface-visibility: hidden;
        }
        .top { top: 0; line-height: 110px; border-bottom: 2px solid #000; border-radius: 8px 8px 0 0; }
        .bottom { bottom: 0; line-height: 0px; border-radius: 0 0 8px 8px; }
        .flap-top {
            top: 0; line-height: 110px; border-bottom: 2px solid #000; border-radius: 8px 8px 0 0;
            transform-origin: bottom; z-index: 5;
        }
        .flap-bottom {
            bottom: 0; line-height: 0px; border-radius: 0 0 8px 8px;
            transform-origin: top; transform: rotateX(90deg); z-index: 5;
        }

        .flipping .flap-top { animation: flipTop 0.25s ease-in forwards; }
        .flipping .flap-bottom { animation: flipBottom 0.25s ease-out 0.25s forwards; }

        @keyframes flipTop {
            0% { transform: rotateX(0deg); filter: brightness(1); }
            100% { transform: rotateX(-90deg); filter: brightness(0.3); }
        }
        @keyframes flipBottom {
            0% { transform: rotateX(90deg); filter: brightness(0.3); }
            100% { transform: rotateX(0deg); filter: brightness(1); }
        }
    </style>
</head>
<body>

    <div class="nixie-container" id="nixie-clock" title="클릭하거나, 정각이 되면 세계선이 변동됩니다!">
        <div class="nixie-digit">1</div><div class="nixie-digit">.</div>
        <div class="nixie-digit">0</div><div class="nixie-digit">4</div>
        <div class="nixie-digit">8</div><div class="nixie-digit">5</div>
        <div class="nixie-digit">9</div><div class="nixie-digit">6</div>
    </div>

    <div class="flip-wrapper">
        <div class="flip-digit" id="month"></div>
        <div class="text-label">월</div>
        <div class="flip-digit" id="date"></div>
        <div class="text-label">일</div>
        <div class="flip-digit weekday" id="day"></div>
        
        <div class="text-label" style="margin-left:20px;"></div>
        
        <div class="flip-digit" id="hours"></div>
        <div class="colon">:</div>
        <div class="flip-digit" id="minutes"></div>
        <div class="colon">:</div>
        <div class="flip-digit" id="seconds"></div>
    </div>

    <script>
        const nixieDigits = document.querySelectorAll('.nixie-digit');
        let isAnimating = false; 

        // 1. 세계선을 바꾸는 '기능'을 하나의 묶음(함수)으로 분리했습니다!
        function changeWorldline() {
            if (isAnimating) return; 
            isAnimating = true;
            
            let count = 0;
            const maxCount = 20; 
            
            const interval = setInterval(() => {
                const randomVal = (Math.random() * 1.999999).toFixed(6);
                
                for(let i = 0; i < randomVal.length; i++) {
                    nixieDigits[i].innerText = randomVal[i];
                }
                count++;
                
                if (count >= maxCount) {
                    clearInterval(interval);
                    isAnimating = false;
                    const finalVal = (Math.random() * 1.999999).toFixed(6);
                    for(let i = 0; i < finalVal.length; i++) {
                        nixieDigits[i].innerText = finalVal[i];
                    }
                }
            }, 50);
        }

        // 마우스를 클릭했을 때도 위 함수가 실행되게 연결
        document.getElementById('nixie-clock').addEventListener('click', changeWorldline);

        // 2. 플립 시계 생성기
        function updateFlipDigit(id, newValue) {
            const el = document.getElementById(id);
            const oldValue = el.dataset.value;
            if (oldValue === newValue) return;
            if (!oldValue) {
                el.dataset.value = newValue;
                el.innerHTML = `<div class="flip-half top">${newValue}</div><div class="flip-half bottom">${newValue}</div>`;
                return;
            }
            el.dataset.value = newValue;
            el.innerHTML = `
                <div class="flip-half top">${newValue}</div>
                <div class="flip-half bottom">${oldValue}</div>
                <div class="flip-half flap-top">${oldValue}</div>
                <div class="flip-half flap-bottom">${newValue}</div>
            `;
            el.classList.remove('flipping');
            void el.offsetWidth; 
            el.classList.add('flipping');
        }

        const weekDays = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];

        // 3. 1초마다 도는 메인 타이머
        function updateTime() {
            const now = new Date();
            
            const month = String(now.getMonth() + 1); 
            const date = String(now.getDate());
            const day = weekDays[now.getDay()]; 

            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');

            updateFlipDigit('month', month);
            updateFlipDigit('date', date);
            updateFlipDigit('day', day);
            updateFlipDigit('hours', hours);
            updateFlipDigit('minutes', minutes);
            updateFlipDigit('seconds', seconds);

            // ★ 오토 타임 리프 발동 조건 ★
            // 초가 '00'이 될 때마다 (즉, 매 1분마다) 자동으로 세계선 애니메이션 실행
            if (seconds === '00' && !isAnimating) {
                changeWorldline();
            }
        }

// (기존 updateTime 함수 등은 그대로 둡니다)

        // ★ 세계선 강제 동기화 로직 ★
        function startSyncedClock() {
            updateTime(); // 일단 켜자마자 현재 시간 표시
            
            const now = new Date();
            const currentMs = now.getMilliseconds();
            
            // 다음 1초(정각)가 되기까지 남은 밀리초(ms) 계산
            const msUntilNextSecond = 1000 - currentMs;

            // 남은 시간만큼 정확히 기다렸다가 정각에 타이머 시작!
            setTimeout(() => {
                updateTime(); // 정각에 한 번 실행
                setInterval(updateTime, 1000); // 그 이후부터는 1초마다 완벽하게 실행
            }, msUntilNextSecond);
        }

        startSyncedClock(); // 동기화 시계 작동!
    </script>
</body>
</html>